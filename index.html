<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>時間とカレンダーと未来計算</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="top-section">
            <div id="current-time"></div>
        </header>
        <main class="bottom-section">
            <section class="left-section">
                <h2>カレンダー</h2>
                <div id="calendar"></div>
            </section>
            <section class="right-section">
                <h2>年齢計算</h2>
                <div class="age-input-container">
                    <label for="birth-date">生年月日を選択してください:</label>
                    <input type="date" id="birth-date">
                </div>
                <div id="age-result"></div>
            </section>
        </main>
    </div>

    <script>
        // 現在時刻の表示
        function updateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const weekday = ['日曜', '月曜', '火曜', '水曜', '木曜', '金曜', '土曜'][now.getDay()];
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');

            // 和暦の計算（簡略版）
            let japaneseEra = '';
            if (year >= 2019) {
                japaneseEra = `令和${year - 2018}年`;
            } else if (year >= 1989) {
                japaneseEra = `平成${year - 1988}年`;
            } else if (year >= 1926) {
                japaneseEra = `昭和${year - 1925}年`;
            } else if (year >= 1912) {
                japaneseEra = `大正${year - 1911}年`;
            } else if (year >= 1868) {
                japaneseEra = `明治${year - 1867}年`;
            }

            document.getElementById('current-time').innerText =
                `${japaneseEra}・${year}/${month}/${day} ${weekday} ${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateTime, 1000);
        updateTime(); // 初回表示

        // カレンダーの表示
        function renderCalendar(year, month) {
            const calendarEl = document.getElementById('calendar');
            calendarEl.innerHTML = ''; // クリア

            const firstDayOfMonth = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayOfWeek = firstDayOfMonth.getDay(); // 0:日曜, 1:月曜...

            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();
            const currentDay = today.getDay(); // 0:日曜, 1:月曜...

            let calendarHtml = `<h3>${year}年 ${month + 1}月</h3>`;
            calendarHtml += '<table>';
            calendarHtml += '<thead><tr><th>日</th><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th>土</th></tr></thead>';
            calendarHtml += '<tbody>';

            let dayCounter = 1;
            for (let i = 0; i < 6; i++) { // 最大6週
                calendarHtml += '<tr>';
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < firstDayOfWeek) {
                        calendarHtml += '<td></td>'; // 月初めまでの空白
                    } else if (dayCounter > daysInMonth) {
                        calendarHtml += '<td></td>'; // 月末以降の空白
                    } else {
                        const cellDate = new Date(year, month, dayCounter);
                        const isToday = (cellDate.getFullYear() === today.getFullYear() &&
                                         cellDate.getMonth() === today.getMonth() &&
                                         cellDate.getDate() === today.getDate());
                        const todayClass = isToday ? 'today' : '';
                        calendarHtml += `<td class="${todayClass}">${dayCounter}</td>`;
                        dayCounter++;
                    }
                }
                calendarHtml += '</tr>';
                if (dayCounter > daysInMonth) break; // 月の終わり
            }
            calendarHtml += '</tbody></table>';
            calendarEl.innerHTML = calendarHtml;
        }

        const today = new Date();
        renderCalendar(today.getFullYear(), today.getMonth());

        // 年齢を計算して表示する関数
        function calculateAge() {
            const birthDateInput = document.getElementById('birth-date').value;
            const ageResultEl = document.getElementById('age-result');

            if (!birthDateInput) {
                ageResultEl.innerText = "生年月日を選択してください。";
                return;
            }

            const birthDate = new Date(birthDateInput);
            if (isNaN(birthDate.getTime()) || birthDate > new Date()) {
                ageResultEl.innerText = "未来の日付は選択できません。有効な生年月日を入力してください。";
                return;
            }

            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDifference = today.getMonth() - birthDate.getMonth();
            const dayDifference = today.getDate() - birthDate.getDate();

            // 今年の誕生日がまだ来ていない場合は、年齢を1歳引く
            if (monthDifference < 0 || (monthDifference === 0 && dayDifference < 0)) {
                age--;
            }

            ageResultEl.innerText = `あなたの現在の年齢は ${age} 歳です。`;
        }

        // 日付が選択されたら自動で年齢を計算する
        document.getElementById('birth-date').addEventListener('input', calculateAge);
    </script>
</body>
</html>
